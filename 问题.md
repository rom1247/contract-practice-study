# 问题与解答

## uniswap V2

### 理解什么是AMM，与订单簿的区别

AMM ： 自动化做市商（Automatic Market Maker）
它的底层逻辑一个连续报价的自动做市函数（恒定乘法公式），用资产池子和数学公式约束并自动给交易价格的系统。

它的订单薄的区别

- 定价方式不同
  - 订单薄是交易者出价
  - AMM是数学公式计算后给出
- 成交方式不同
  - 订单薄是可立即成交和等待成交
  - AMM是立即成交
- 流动性不同
  - 订单薄是分散的，靠的是价格深度
  - AMM是连续的，由数学公式约束
- 价格滑点产生不同
  - 订单薄是看价格深度，深度小，用户吃掉更多的订单，就会产生滑点，那如果吃的挂单都是一个价格，那就没有滑点了
  - AMM是只要有交易就有滑点，这是由于AMM的价格是数学公式决定的

### AMM的核心算法是什么

核心算法就是一个定价函数，约束资产总量相对不变，约束每次交易的价格状态

### 什么是滑点，用户交易时怎么避免滑点过高（三明治攻击？）

滑点就是价格改变了，更直接的解释就是买入\卖出的价格不是你期望的价格了。
在AMM中，滑点就是实际成交价格和交易前瞬时价格的差值，这个差值最终留在资产池子里（待分配的收益）。

用户交易时怎么避免滑点过高：

| 方法     | 说明                  |
| ------ | ------------------- |
| 控制交易量  | 拆单、大额分批、小额交易        |
| 选深池    | 池子流动性高 → 滑点低        |
| 滑点容忍度  | 设置合理的最大滑点，超过 revert |
| 时间选择   | 避免极端行情，选择流动性高峰      |
| 交易路径优化 | 最短路径、少跳交易，减少累计滑点    |

什么是三明治攻击：
三明治攻击是一种 MEV 攻击，攻击者在 AMM 中，利用用户允许的滑点，在其交易前后各插入一笔交易，从用户“必然推动的价格变化”中获利。

>MEV(Maximal Extractable Value)：区块生产者或交易排序者，通过调整交易顺序、包含或排除交易，能够从区块中额外获取的最大价值

时间顺序：

```css
攻击者买入   ←（前夹）
用户交易     ←（中间）
攻击者卖出   ←（后夹）

```

原因：还是因为AMM是本质是一个定价函数，交易价格是交易是计算得到的，而在公链内存池中交易是公开的，只要用户设置了可以接受的滑点，就有可能发生攻击。

那么攻击者是怎么做的呢？
在公链中，用户发起交易就是广播到全网，任何节点都可以看到这笔交易，在内存池中交易的处理顺序是先到先处理，节点可根据 Gas 价格/优先级 调整顺序，并且交易数据是公开的，可以查询到输入（amountIn）和期望最小的输出（amountOutMin），就可以精确的反推出可以接受的滑点，然后攻击者就可以像三明治一样的时间顺序先买入，再以用户期望的价格（最大滑点）卖出，从而达到获利。

### LP的作用是什么？

LP ： 流动性提供者（Liquidity Provider），就是向 AMM 池子提供代币资产的人。

作用：

- 为交易提供流动性，LP 存入资产形成交易池，同时也是定价的基础

## uniswap V3

### 集中流动性的优势是什么，怎么实现的

### tick跟价格有什么关系，为什么需要tick

### tickspacing跟费率有什么关系，为什么
